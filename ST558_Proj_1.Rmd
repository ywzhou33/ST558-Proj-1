---
title: "ST558 Project 1"
author: "Aries Zhou"
date: "10/3/2021"
---

```{r, echo = FALSE, eval = FALSE}
rmarkdown::render("./ST558_Proj_1.Rmd", 
                  output_format = "github_document", 
                  output_dir = "../ywzhou33.github.io/_posts/",
                  output_options = list(html_preview = FALSE, keep_html=FALSE))
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE, fig.align='center', fig.path = "../ywzhou33.github.io/images/")
```

[The link to Github Pages repo: ](https://github.com/ywzhou33/ST558-Project-1.git)  
[The link to Github Blog repo: ](https://github.com/ywzhou33/ywzhou33.github.io.git)  

```{r Packages, echo=TRUE}
library(httr)
library(jsonlite)
library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
```

##Connects to the One Call API.  

Parameters:

 - `lat` `(required)` - Latitude; geographical coordinates that have values between -180 and 180.  
 - `lon` `(required)` - Longitude; geographical coordinates that have values between -180 and 180.  
 - `appid` `(required)` - Your unique API key  
 - `exclude` `(optional)` - You can use it to exclude some parts from the data, available values are `current`, `minutely`, `hourly`, `daily`, `alerts`, should be a comma-delimited list (without spaces).  
 - `units` `(optional)` - Units of measurement. `standard` (Kelvin & meter/sec), `metric` (Celsius & meter/sec) and `imperial` (Fahrenheit & miles/hour) units are available. If you do not use the `units` parameter, `standard` units will be applied by default.  
 - `lang` `(optinal)` - You can use this parameter to get the output in your language.  

```{r API, echo=TRUE}
#To get access to current weather, minute forecast for 1 hour, hourly forecast for 48 hours, daily forecast for 7 days and government weather alerts

lat <- 35.78
lon <- seq(from = -180, to = 180, by = 50.66)
exclude <- "current,minutely,hourly"
units <- "metric"
appid <- "1f302e9647903cb7b350a5580d5c00dc" 
"6U4chzdkpf2hc4b5jNwsmkN07rhH4OWC" # API key

#function to get a vector containing a list of URL to request datas from API.
get.URL <- function(lat, lon, appid, exclude=NULL, units = NULL, lang = NULL, ...){
        base_url<- "https://api.openweathermap.org/data/2.5/onecall?"
        if (is.null(lat)){
        URL <- paste(base_url, "lat=", lat, sep = "")    
        }
        if (is.null(lon)){
        URL <- paste(base_url, "lat=", lat, "&lon=", lon, sep = "")    
        }
        if (is.null(appid)){
        URL <- paste(base_url, "lat=", lat, "&lon=", lon, "&appid=", appid, sep = "")
        }
        if (is.null(exclude)){
        URL <- paste(base_url, "lat=", lat, "&lon=", lon, "&exclude=", tolower(exclude), "&appid=", appid, sep = "")
        }
        if (is.null(units)){
        URL <- paste(base_url, "lat=", lat, "&lon=", lon, "&exclude=", tolower(exclude), "&units=", units, "&appid=", appid, sep = "")
        }
        if (is.null(lang)){
        URL <- paste(base_url, "lat=", lat, "&lon=", lon, "&exclude=", tolower(exclude), "&units=", units, "&appid=", appid, sep = "")
        }
        else{
        return("Error: Invalid input")
        }
        URL
}

URL <- get.URL(lat=lat, lon=lon, appid=appid, exclude=exclude, units=units)        

Data.raw <- list()
Data.F7 <- list()

#Use for loop to get a list of data parsed from API
for (i in 1:length(URL)) {
j <- i
Data.raw[[j]] <- httr::GET(URL[i])
Data.F7[[j]] <- Data.raw[[j]]$content %>% rawToChar() %>% fromJSON()
}
```


Get data
```{r Data, echo=TRUE}
select.data <- function(Data.F7, k){
        Data.a <- Data.F7[[k]][["daily"]] %>% 
            select(dt, pressure:dew_point, starts_with("wind"), rain)
        Data.b <- data.frame(Data.F7[[k]][["daily"]]$temp[2], 
                      Data.F7[[k]][["daily"]]$temp[3], 
                      Data.F7[[k]][["daily"]]$feels_like[1], 
                      Data.F7[[k]][2])
        Data.ab <- cbind(Data.a, Data.b)
        return(Data.ab)
}

get.full.data <- function(Data){

Data.a <- data.frame()
Data.b <- data.frame()
Full.data <- data.frame()

for (k in 1:length(Data)){
 New.data <- select.data(Data, k)
 Full.data <- rbind(New.data, Full.data)
}
return(Full.data)
}

Full.data  <- get.full.data(Data = Data.F7)


```

```{r NewVar, echo=TRUE}
weather <- Full.data %>% 
        mutate(area = if_else((lon>=-120.74)&(lon<=-75.59), "Land", 
                      if_else((lon>=-5.91)&(lon<=120.44), "Land", "Water")),
               wind_status = if_else(wind_speed>=8.9, "Windy", 
                      if_else(wind_speed>=6.7, "Breezy", "Clam")),
               temp_day = (min+max)/2) %>% 
        as_tibble()  
#group_by(area) %>% summarise(temp_avg = mean(temp_day), rain_avg = mean(rain))
```

Graphical Summaries  

```{r histogram, echo=TRUE}
#Histogram for Temperature
his_temp <- ggplot(data = weather, aes(x = temp_day))
his_temp + geom_histogram(aes(fill = as.factor(area))) +
           geom_density(aes(fill = as.factor(area)))+ 
  labs(x="Average Daily Temperature", title = "Histogram for Temperature") + 
  scale_fill_discrete(name = "Area")
```

```{r boxplot_temp, echo=TRUE}
#boxplot for temperature
box_temp <- ggplot(data = weather, aes(x = temp_day))
box_temp + geom_boxplot(aes(y = as.factor(area))) + 
  geom_jitter(aes(x = temp_day, y = as.factor(area), color = as.factor(area))) + 
labs(x ="Temperature", y ="Area", title = "Boxplot for Temperature") +
scale_color_discrete(name = "Area") + 
coord_flip() 
```

```{r bar_chart, echo=TRUE}
#barchart for Wind Status
bar_wind <- ggplot(data = weather, aes(x = as.character(wind_status)))
bar_wind + geom_bar(aes(fill = as.factor(area)), position = "dodge") + 
  labs(x="Wind Status", title = "Bar Chart for Wind Status") + 
  scale_fill_discrete(name = "Area")
```

```{r boxplot_hum, echo=TRUE}
#boxplot for humidity
box_hum <- ggplot(data = weather, aes(x = humidity))
box_hum + geom_boxplot(aes(y = as.factor(area))) + 
  geom_jitter(aes(x = humidity, y = as.factor(area), color = as.factor(area))) + 
labs(x ="Humidity", y ="Area", title = "Boxplot for Humidity") +
scale_color_discrete(name = "Area") + 
coord_flip()
```


```{r scatter, echo=TRUE}
correlation <- cor(weather$wind_speed, weather$humidity)
correlation

#Scatterplot for Wind Status v.s. Humidity.
scatter <- ggplot(data = weather, aes(x = wind_speed, y = humidity))
scatter + geom_point(aes(color = as.factor(wind_status), shape = as.factor(area))) + 
geom_smooth(method = lm) + 
labs(title = "Wind Speed vs Humidity", x = "Wind Speed", y = "Humidity") + 
scale_color_discrete(name = "Wind Status") +
scale_shape_discrete(name = "Area")
```

